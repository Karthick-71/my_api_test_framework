AIS API TEST RUNNER FLOW DIAGRAM (ASCII ART)
=======================================================================================

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AIS API TEST RUNNER FLOW                              │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              INITIALIZATION PHASE                               │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │   START     │───▶│ LOAD ENV    │───▶│ AWS CLIENTS │───▶│ READ EXCEL  │
    │   AIS API   │    │ VARIABLES   │    │ S3/ATHENA/  │    │   FILE      │
    │ TEST RUNNER │    │             │    │ DYNAMODB    │    │             │
    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                                                                          │
                                                                          ▼
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │                    EXTRACT TEST CASE DATA FROM EXCEL                         │
    │  ┌──────────────────┐  ┌─────────────────┐  ┌─────────────────────────────┐  │
    │  │   SHEET NAME     │  │  COLUMN NAMES   │  │      TEST CASE DATA         │  │
    │  │ais_integration_tc│  │to_process       │  │  • test_case_id             │  │
    │  │                  │  │test_case_id     │  │  • test_case_name           │  │
    │  │                  │  │test_case_name   │  │  • api_name                 │  │
    │  │                  │  │api_name         │  │  • api_url                  │  │
    │  │                  │  │api_method       │  │  • default_api_payload      │  │
    │  │                  │  │default_payload  │  │  • response_status_code     │  │
    │  │                  │  │expected_result  │  │  • actual_result            │  │
    │  └──────────────────┘  └─────────────────┘  └─────────────────────────────┘  │
    └──────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                            TEST EXECUTION PHASE                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────┐
    │ GENERATE    │
    │ TEST RUNNER │
    │    ID       │
    └─────────────┘
           │
           ▼
    ┌─────────────────────────────────────────────────────────────────────────────┐
    │                        FOR EACH TEST CASE IN EXCEL                          │
    └─────────────────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │ EXTRACT     │───▶│ GENERATE    │───▶│ PREPARE     │
    │ API NAME &  │    │ SEARCH ID   │    │ API PAYLOAD │
    │ TEST CASE   │    │ MONGODB     │    │             │
    │    ID       │    │ OBJECT ID   │    │             │
    └─────────────┘    └─────────────┘    └─────────────┘
                                                     │
                                                     ▼
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │                              API NAME CHECK                                  │
    │  ┌─────────────────────────────────────────────────────────────────────────┐ │
    │  │                    IS API NAME == "ais_jerry_transform_rates"?          │ │
    │  │                                                                         │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │     YES     │                    │     NO      │                     │ │
    │  │  │             │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  │           │                                │                            │ │
    │  │           ▼                                ▼                            │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │ PREPARE     │                    │ LOG ERROR   │                     │ │
    │  │  │ PAYLOAD     │                    │ API NOT     │                     │ │
    │  │  │             │                    │ RECOGNIZED  │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  └─────────────────────────────────────────────────────────────────────────┘ │
    └──────────────────────────────────────────────────────────────────────────────┘
           │                                │
           ▼                                ▼
    ┌─────────────┐                    ┌─────────────┐
    │ PAYLOAD     │                    │ ADD FAILED  │
    │ PREPARATION │                    │ RESULT TO   │
    │             │                    │ COLLECTION  │
    └─────────────┘                    └─────────────┘
           │                                
           ▼                                
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │                            PAYLOAD PREPARATION                               │
    │  ┌─────────────────────────────────────────────────────────────────────────┐ │
    │  │                    DEFAULT API PAYLOAD == "nan"?                        │ │
    │  │                                                                         │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │     YES     │                    │     NO      │                     │ │
    │  │  │             │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  │           │                                │                            │ │
    │  │           ▼                                ▼                            │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │ GET DEFAULT │                    │ USE PAYLOAD │                     │ │
    │  │  │ PAYLOAD FROM│                    │ FROM TEST   │                     │ │
    │  │  │ DEFAULT_    │                    │ CASE META   │                     │ │
    │  │  │ PAYLOAD     │                    │             │                     │ │
    │  │  │ SHEET       │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  └─────────────────────────────────────────────────────────────────────────┘ │
    └──────────────────────────────────────────────────────────────────────────────┘
           │                                │
           └────────────┬───────────────────┘
                        │
                        ▼
    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │ UPDATE JSON │───▶│ UPDATE      │───▶│ TRACK       │
    │ DATA WITH   │    │ SEARCH ID   │    │ IN PAYLOAD  │
    │ TEST CASE   │    │MODIFICATIONS│    │ FOR QUERIES │
    │             │    │             │    │ ATHENA &    │
    │             │    │             │    │ DYNAMODB    │
    └─────────────┘    └─────────────┘    └─────────────┘
           │                    │                    │
           ▼                    ▼                    ▼
    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │ EXECUTE     │───▶│ MEASURE     │───▶│ CHECK API   │
    │ API CALL    │    │ RESPONSE    │    │ RESPONSE    │
    │ ais_platform│    │ TIME        │    │ STATUS CODE │
    │ _transform_ │    │             │    │             │
    │ rates_api   │    │             │    │             │
    └─────────────┘    └─────────────┘    └─────────────┘
           │                    │                    │
           ▼                    ▼                    ▼
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │                              API RESPONSE CHECK                              │
    │  ┌─────────────────────────────────────────────────────────────────────────┐ │
    │  │                        STATUS CODE == 200?                              │ │
    │  │                                                                         │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │     YES     │                    │     NO      │                     │ │
    │  │  │             │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  │           │                                │                            │ │
    │  │           ▼                                ▼                            │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │ PARSE       │                    │ LOG API     │                     │ │
    │  │  │ RESPONSE    │                    │ FAILURE     │                     │ │
    │  │  │ JSON        │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  └─────────────────────────────────────────────────────────────────────────┘ │
    └──────────────────────────────────────────────────────────────────────────────┘
           │                                │
           ▼                                ▼
    ┌─────────────┐                    ┌─────────────┐
    │ EXECUTE     │                    │ ADD FAILED  │
    │ RESPONSE    │                    │ RESULT TO   │
    │ VALIDATION  │                    │ COLLECTION  │
    │ rpa_v3_     │                    │             │
    │ api_asserts │                    │             │
    └─────────────┘                    └─────────────┘
           │                                
           ▼                                
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │                              VALIDATION CHECK                                │
    │  ┌─────────────────────────────────────────────────────────────────────────┐ │
    │  │                        VALIDATION PASSED?                               │ │
    │  │                                                                         │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │     YES     │                    │     NO      │                     │ │
    │  │  │             │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  │           │                                │                            │ │
    │  │           ▼                                ▼                            │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │ LOG TEST    │                    │ LOG TEST    │                     │ │
    │  │  │ CASE        │                    │ CASE        │                     │ │
    │  │  │ PASSED      │                    │ FAILED      │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  └─────────────────────────────────────────────────────────────────────────┘ │
    └──────────────────────────────────────────────────────────────────────────────┘
           │                                │
           ▼                                ▼
    ┌─────────────┐                    ┌─────────────┐
    │ ADD PASSED  │                    │ ADD         │
    │ RESULT TO   │                    │ AMBIGUITY   │
    │ COLLECTION  │                    │ RESULT TO   │
    │             │                    │ COLLECTION  │
    └─────────────┘                    └─────────────┘
           │                                │
           └────────────┬───────────────────┘
                        ▼
                    ┌─────────────┐
                    │ LOG TEST    │
                    │ CASE        │
                    │ COMPLETION  │
                    └─────────────┘
                        │
                        ▼
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │                              MORE TEST CASES?                                │
    │  ┌─────────────────────────────────────────────────────────────────────────┐ │
    │  │                                                                         │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │     YES     │                    │     NO      │                     │ │
    │  │  │             │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  │           │                                │                            │ │
    │  │           ▼                                ▼                            │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │ CONTINUE    │                    │ POST-       │                     │ │
    │  │  │ WITH NEXT   │                    │ PROCESSING  │                     │ │
    │  │  │ TEST CASE   │                    │ PHASE       │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  └─────────────────────────────────────────────────────────────────────────┘ │
    └──────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                            POST-PROCESSING PHASE                                │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────┐
    │ EXECUTE     │
    │ QUERIES     │
    └─────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │                              SEARCH IDS EXIST?                               │
    │  ┌─────────────────────────────────────────────────────────────────────────┐ │
    │  │                        FOR ATHENA QUERY?                                │ │
    │  │                                                                         │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │     YES     │                    │     NO      │                     │ │
    │  │  │             │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  │           │                                │                            │ │
    │  │           ▼                                ▼                            │ │
    │  │  ┌─────────────┐                    ┌─────────────┐                     │ │
    │  │  │ EXECUTE     │                    │ LOG: NO     │                     │ │
    │  │  │ ATHENA      │                    │ SEARCH IDS  │                     │ │
    │  │  │ QUERY       │                    │ FOR ATHENA  │                     │ │
    │  │  │ GET S3      │                    │             │                     │ │
    │  │  │ PRESIGNED   │                    │             │                     │ │
    │  │  │ URL         │                    │             │                     │ │
    │  │  └─────────────┘                    └─────────────┘                     │ │
    │  └─────────────────────────────────────────────────────────────────────────┘ │
    └──────────────────────────────────────────────────────────────────────────────┘
           │                                
           ▼                                
    ┌─────────────┐                         
    │ SEARCH IDS  │                         
    │ EXIST FOR   │                         
    │ DYNAMODB    │                         
    │ QUERY?      │                         
    └─────────────┘                         
           │                                
           ▼                                
    ┌─────────────────────────────────────────────────────────────────────────────┐
    │  ┌─────────────┐                    ┌─────────────┐                         │
    │  │     YES     │                    │     NO      │                         │
    │  │             │                    │             │                         │
    │  └─────────────┘                    └─────────────┘                         │
    │           │                                │                                │
    │           ▼                                ▼                                │
    │  ┌─────────────┐                    ┌─────────────┐                         │
    │  │ EXECUTE     │                    │ LOG: NO     │                         │
    │  │ DYNAMODB    │                    │ SEARCH IDS  │                         │
    │  │ QUERY       │                    │ FOR DYNAMODB│                         │
    │  │ GET S3      │                    │             │                         │
    │  │ PRESIGNED   │                    │             │                         │
    │  │ URL         │                    │             │                         │
    │  └─────────────┘                    └─────────────┘                         │
    └─────────────────────────────────────────────────────────────────────────────┘
           │                                │
           └────────────┬───────────────────┘
                        ▼
    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │ SAVE TEST   │───▶│ UPLOAD TEST │───▶│ UPLOAD TEST │
    │ RESULTS TO  │    │ INPUT FILE  │    │ RESULTS TO  │
    │ CSV FILE    │    │ TO S3       │    │ S3          │
    │             │    │ GET         │    │ GET         │
    │             │    │ PRESIGNED   │    │ PRESIGNED   │
    │             │    │ URL         │    │ URL         │
    └─────────────┘    └─────────────┘    └─────────────┘
           │                    │                    │
           ▼                    ▼                    ▼
    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │ LOG ALL     │───▶│ END AIS API │───▶│ TEST RUNNER │
    │ PRESIGNED   │    │ TEST RUNNER │    │ COMPLETE    │
    │ URLS        │    │             │    │             │
    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DATA STRUCTURES                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  COLLECTION NAME        │  DATA TYPE  │  DESCRIPTION                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│  test_results           │  List[Dict] │  Test execution results with status     │
│  tc_search_id           │  List[str]  │  Search IDs for Athena queries          │
│  dynamodb_query_tc_     │  List[str]  │  Search IDs for DynamoDB queries        │
│  search_id              │  str        │                                         │
│  test_runner_id         │  str        │  Unique identifier for test run         │
│  new_search_id          │  str        │  MongoDB Object ID for each test case   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ERROR HANDLING                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  ERROR TYPE             │  HANDLING METHOD  │  RESULT STATUS                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│  API Status != 200      │  Log & Record     │  Failed                           │
│  Assertion Error        │  Try/Except       │  Ambiguous                        │
│  Unrecognized API       │  Log Error        │  Failed - Input Error             │
│  General Exception      │  Try/Except       │  Error                            │
│  Missing Search IDs     │  Conditional Check│  Log: No Search IDs               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              PERFORMANCE METRICS                                │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  METRIC                 │  MEASUREMENT      │  DESCRIPTION                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│  Response Time          │  time.time()      │  API call duration                │
│  Rate Limiting          │  3-second delay   │  Between test cases               │
│  Batch Processing       │  Loop iteration   │  Multiple test cases              │
│  File Upload            │  S3 presigned URL │  Cloud storage integration        │
└─────────────────────────────────────────────────────────────────────────────────┘

==========================================================================================
                              END OF FLOW DIAGRAM
==========================================================================================
